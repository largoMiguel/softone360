<div class="soft-admin-container">
    <div class="header">
        <div class="header-content">
            <div>
                <h1>üîê Panel de Super Administrador</h1>
                <p class="subtitle">Gesti√≥n de Entidades y Administradores</p>
            </div>
            <button class="btn btn-logout" (click)="logout()">
                üö™ Cerrar Sesi√≥n
            </button>
        </div>
    </div>

    <!-- Vista: Listado de Entidades -->
    <div *ngIf="currentView === 'entities'" class="entities-view">
        <div class="view-header">
            <h2>Entidades del Sistema</h2>
            <button class="btn btn-primary" (click)="showCreateEntity()">
                ‚ûï Nueva Entidad
            </button>
        </div>

        <div class="entities-grid" *ngIf="!loading && entities.length > 0">
            <div class="entity-card" *ngFor="let entity of entities" [class.inactive]="!entity.is_active">
                <div class="entity-header">
                    <div>
                        <h3>{{ entity.name }}</h3>
                        <span class="entity-code">{{ entity.code }}</span>
                    </div>
                    <span class="status-badge" [class.active]="entity.is_active">
                        {{ entity.is_active ? '‚úì Activa' : '‚úó Inactiva' }}
                    </span>
                </div>

                <div class="entity-info">
                    <p *ngIf="entity.description">{{ entity.description }}</p>
                    <p *ngIf="entity.email">üìß {{ entity.email }}</p>
                    <p *ngIf="entity.phone">üìû {{ entity.phone }}</p>
                    <p class="entity-slug">
                        üîó <a [href]="'/' + entity.slug" target="_blank">{{ entity.slug }}</a>
                        <button class="btn-copy" (click)="copySlug(entity.slug)" title="Copiar URL">üìã</button>
                    </p>
                </div>

                <div class="entity-stats">
                    <div class="stat">
                        <span class="stat-value">{{ entity.admin_count }}</span>
                        <span class="stat-label">Admins</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value">{{ entity.user_count }}</span>
                        <span class="stat-label">Usuarios</span>
                    </div>
                </div>

                <div class="entity-actions">
                    <button class="btn btn-sm btn-info" (click)="viewEntityUsers(entity)">
                        üë• Ver Usuarios
                    </button>
                    <button class="btn btn-sm btn-success" (click)="showCreateAdmin(entity)">
                        ‚ûï Crear Admin
                    </button>
                    <button class="btn btn-sm btn-primary" (click)="showEditEntity(entity)">
                        ‚úèÔ∏è Editar
                    </button>
                    <button class="btn btn-sm" [class.btn-warning]="entity.is_active"
                        [class.btn-secondary]="!entity.is_active" (click)="toggleEntityStatus(entity)">
                        {{ entity.is_active ? 'üîí Desactivar' : 'üîì Activar' }}
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="deleteEntity(entity)">
                        üóëÔ∏è Eliminar
                    </button>
                </div>
            </div>
        </div>

        <div *ngIf="loading" class="loading">
            <p>Cargando entidades...</p>
        </div>

        <div *ngIf="!loading && entities.length === 0" class="empty-state">
            <p>No hay entidades registradas</p>
            <button class="btn btn-primary" (click)="showCreateEntity()">
                Crear Primera Entidad
            </button>
        </div>
    </div>

    <!-- Vista: Crear Entidad -->
    <div *ngIf="currentView === 'create-entity'" class="create-entity-view">
        <div class="view-header">
            <h2>Nueva Entidad</h2>
            <button class="btn btn-secondary" (click)="showEntities()">
                ‚Üê Volver
            </button>
        </div>

        <form class="form-container" (ngSubmit)="createEntity()">
            <div class="form-group">
                <label for="name">Nombre de la Entidad *</label>
                <input type="text" id="name" [(ngModel)]="newEntity.name" (blur)="generateSlug()" name="name" required
                    class="form-control" placeholder="Ej: Alcald√≠a de Chiquiz√° - Boyac√°">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="code">C√≥digo *</label>
                    <input type="text" id="code" [(ngModel)]="newEntity.code" name="code" required class="form-control"
                        placeholder="Ej: ALC-CHIQUIZA">
                </div>

                <div class="form-group">
                    <label for="nit">NIT</label>
                    <input type="text" id="nit" [(ngModel)]="newEntity.nit" name="nit" class="form-control"
                        placeholder="Ej: 891801994">
                    <small class="form-hint">NIT de la entidad para consultas de contrataci√≥n SECOP</small>
                </div>

                <div class="form-group">
                    <label for="slug">URL Slug *</label>
                    <input type="text" id="slug" [(ngModel)]="newEntity.slug" name="slug" required class="form-control"
                        placeholder="Ej: chiquiza-boyaca">
                    <small class="form-hint">Se generar√° autom√°ticamente del nombre. Se usar√° para la URL
                        p√∫blica.</small>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Descripci√≥n</label>
                <textarea id="description" [(ngModel)]="newEntity.description" name="description" rows="3"
                    class="form-control" placeholder="Descripci√≥n de la entidad"></textarea>
            </div>

            <div class="form-group">
                <label for="logo_url">URL del Logo</label>
                <input type="url" id="logo_url" [(ngModel)]="newEntity.logo_url" name="logo_url" class="form-control"
                    placeholder="https://ejemplo.com/logo.png">
                <small class="form-hint">URL de la imagen del logo de la entidad (opcional)</small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" [(ngModel)]="newEntity.email" name="email" class="form-control">
                </div>

                <div class="form-group">
                    <label for="phone">Tel√©fono</label>
                    <input type="tel" id="phone" [(ngModel)]="newEntity.phone" name="phone" class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label for="address">Direcci√≥n</label>
                <input type="text" id="address" [(ngModel)]="newEntity.address" name="address" class="form-control">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="horario_atencion">Horario de Atenci√≥n</label>
                    <input type="text" id="horario_atencion" [(ngModel)]="newEntity.horario_atencion"
                        name="horario_atencion" class="form-control"
                        placeholder="Ej: Lunes a Viernes 8:00 AM - 5:00 PM">
                </div>

                <div class="form-group">
                    <label for="tiempo_respuesta">Tiempo de Respuesta</label>
                    <input type="text" id="tiempo_respuesta" [(ngModel)]="newEntity.tiempo_respuesta"
                        name="tiempo_respuesta" class="form-control" placeholder="Ej: Respuesta en 24 horas">
                </div>
            </div>

            <div class="form-group">
                <label>M√≥dulos Activos</label>
                <div class="checkbox-grid">
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_pqrs" name="enable_pqrs"> PQRS</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_users_admin" name="enable_users_admin">
                        Administraci√≥n de Usuarios</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_planes_institucionales"
                            name="enable_planes_institucionales"> Planes Institucionales</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_pdm" name="enable_pdm">
                        Plan de Desarrollo Municipal</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_contratacion"
                            name="enable_contratacion">
                        Contrataci√≥n</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_asistencia"
                            name="enable_asistencia">
                        Control de Asistencia</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_reports_pdf" name="enable_reports_pdf">
                        Reportes PDF</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_ai_reports" name="enable_ai_reports">
                        An√°lisis con IA</label>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="showEntities()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="loading">
                    {{ loading ? 'Creando...' : 'Crear Entidad' }}
                </button>
            </div>
        </form>
    </div>

    <!-- Vista: Editar Entidad -->
    <div *ngIf="currentView === 'edit-entity'" class="create-entity-view">
        <div class="view-header">
            <h2>Editar Entidad</h2>
            <button class="btn btn-secondary" (click)="showEntities()">
                ‚Üê Volver
            </button>
        </div>

        <form class="form-container" (ngSubmit)="updateEntity()">
            <div class="form-group">
                <label for="edit-name">Nombre de la Entidad *</label>
                <input type="text" id="edit-name" [(ngModel)]="newEntity.name" name="name" required class="form-control"
                    placeholder="Ej: Alcald√≠a de Chiquiz√° - Boyac√°">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="edit-code">C√≥digo *</label>
                    <input type="text" id="edit-code" [(ngModel)]="newEntity.code" name="code" required
                        class="form-control" placeholder="Ej: ALC-CHIQUIZA">
                </div>

                <div class="form-group">
                    <label for="edit-nit">NIT</label>
                    <input type="text" id="edit-nit" [(ngModel)]="newEntity.nit" name="nit" class="form-control"
                        placeholder="Ej: 891801994">
                    <small class="form-hint">NIT de la entidad para consultas de contrataci√≥n SECOP</small>
                </div>

                <div class="form-group">
                    <label for="edit-slug">URL Slug *</label>
                    <input type="text" id="edit-slug" [(ngModel)]="newEntity.slug" name="slug" required
                        class="form-control" placeholder="Ej: chiquiza-boyaca">
                    <small class="form-hint">Se usar√° para la URL p√∫blica.</small>
                </div>
            </div>

            <div class="form-group">
                <label for="edit-description">Descripci√≥n</label>
                <textarea id="edit-description" [(ngModel)]="newEntity.description" name="description" rows="3"
                    class="form-control" placeholder="Descripci√≥n de la entidad"></textarea>
            </div>

            <div class="form-group">
                <label for="edit-logo_url">URL del Logo</label>
                <input type="url" id="edit-logo_url" [(ngModel)]="newEntity.logo_url" name="logo_url"
                    class="form-control" placeholder="https://ejemplo.com/logo.png">
                <small class="form-hint">URL de la imagen del logo de la entidad (opcional)</small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="edit-email">Email</label>
                    <input type="email" id="edit-email" [(ngModel)]="newEntity.email" name="email" class="form-control">
                </div>

                <div class="form-group">
                    <label for="edit-phone">Tel√©fono</label>
                    <input type="tel" id="edit-phone" [(ngModel)]="newEntity.phone" name="phone" class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label for="edit-address">Direcci√≥n</label>
                <input type="text" id="edit-address" [(ngModel)]="newEntity.address" name="address"
                    class="form-control">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="edit-horario_atencion">Horario de Atenci√≥n</label>
                    <input type="text" id="edit-horario_atencion" [(ngModel)]="newEntity.horario_atencion"
                        name="horario_atencion" class="form-control"
                        placeholder="Ej: Lunes a Viernes 8:00 AM - 5:00 PM">
                </div>

                <div class="form-group">
                    <label for="edit-tiempo_respuesta">Tiempo de Respuesta</label>
                    <input type="text" id="edit-tiempo_respuesta" [(ngModel)]="newEntity.tiempo_respuesta"
                        name="tiempo_respuesta" class="form-control" placeholder="Ej: Respuesta en 24 horas">
                </div>
            </div>

            <div class="form-group">
                <label>M√≥dulos Activos</label>
                <div class="checkbox-grid">
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_pqrs" name="edit_enable_pqrs">
                        PQRS</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_users_admin"
                            name="edit_enable_users_admin"> Administraci√≥n de Usuarios</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_planes_institucionales"
                            name="edit_enable_planes_institucionales"> Planes Institucionales</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_pdm" name="edit_enable_pdm"> Plan de
                        Desarrollo Municipal</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_contratacion"
                            name="edit_enable_contratacion">
                        Contrataci√≥n</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_asistencia"
                            name="edit_enable_asistencia">
                        Control de Asistencia</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_reports_pdf"
                            name="edit_enable_reports_pdf"> Reportes PDF</label>
                    <label><input type="checkbox" [(ngModel)]="newEntity.enable_ai_reports"
                            name="edit_enable_ai_reports"> An√°lisis con IA</label>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="showEntities()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="loading">
                    {{ loading ? 'Actualizando...' : 'Actualizar Entidad' }}
                </button>
            </div>
        </form>
    </div>

    <!-- Vista: Usuarios de Entidad -->
    <div *ngIf="currentView === 'entity-users'" class="entity-users-view">
        <div class="view-header">
            <div>
                <h2>Usuarios de {{ selectedEntity?.name }}</h2>
                <p class="subtitle">C√≥digo: {{ selectedEntity?.code }}</p>
            </div>
            <button class="btn btn-secondary" (click)="showEntities()">
                ‚Üê Volver
            </button>
        </div>

        <div class="users-table" *ngIf="!loading && entityUsers.length > 0">
            <table>
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Creado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of entityUsers" [class.inactive]="!user.is_active">
                        <td><strong>{{ user.username }}</strong></td>
                        <td>{{ user.full_name }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            <span class="role-badge" [class]="user.role">
                                {{ getRoleName(user.role) }}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge" [class.active]="user.is_active">
                                {{ user.is_active ? 'Activo' : 'Inactivo' }}
                            </span>
                        </td>
                        <td>{{ user.created_at | date:'short':'America/Bogota':'es-CO' }}</td>
                        <td>
                            <button *ngIf="canEditUser(user)" class="btn btn-sm btn-primary" (click)="showEditUser(user)">
                                ‚úèÔ∏è Editar
                            </button>
                            <button class="btn btn-sm" [class.btn-warning]="user.is_active"
                                [class.btn-secondary]="!user.is_active" (click)="toggleUserStatus(user)">
                                {{ user.is_active ? 'Desactivar' : 'Activar' }}
                            </button>
                            <button *ngIf="canDeleteUser(user)" class="btn btn-sm btn-danger" (click)="deleteUserConfirm(user)" title="Eliminar usuario">
                                üóëÔ∏è Eliminar
                            </button>
                            <span *ngIf="!canEditUser(user)" class="text-muted small">
                                (Solo SuperAdmin puede editar administradores)
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div *ngIf="!loading && entityUsers.length === 0" class="empty-state">
            <p>No hay usuarios en esta entidad</p>
            <button *ngIf="currentUserRole === 'superadmin'" class="btn btn-primary" (click)="showCreateAdmin(selectedEntity!)">
                Crear Primer Usuario
            </button>
            <div *ngIf="currentUserRole !== 'superadmin'" class="alert alert-info">
                <strong>‚ö†Ô∏è Informaci√≥n:</strong> Solo el SuperAdmin puede crear nuevos administradores.
            </div>
        </div>
    </div>

    <!-- Vista: Editar Usuario -->
    <div *ngIf="currentView === 'edit-user'" class="create-admin-view">
        <div class="view-header">
            <h2>Editar Usuario</h2>
            <button class="btn btn-secondary" (click)="cancelEditUser()">
                ‚Üê Volver
            </button>
        </div>

        <form class="form-container" (ngSubmit)="updateUser()">
            <div class="form-group">
                <label for="edit-role">Rol</label>
                <select id="edit-role" [(ngModel)]="editUserForm.role" name="edit_role" class="form-control">
                    <option value="admin">Administrador</option>
                    <option value="secretario">Secretario</option>
                    <option value="ciudadano">Ciudadano</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="edit-username">Nombre de Usuario *</label>
                    <input type="text" id="edit-username" [(ngModel)]="editUserForm.username" name="edit_username"
                        required class="form-control">
                </div>

                <div class="form-group">
                    <label for="edit-full_name">Nombre Completo *</label>
                    <input type="text" id="edit-full_name" [(ngModel)]="editUserForm.full_name" name="edit_full_name"
                        required class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label for="edit-email">Email *</label>
                <input type="email" id="edit-email" [(ngModel)]="editUserForm.email" name="edit_email" required
                    class="form-control">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="edit-password">Nueva Contrase√±a (opcional)</label>
                    <input type="password" id="edit-password" [(ngModel)]="editUserForm.password" name="edit_password"
                        class="form-control" placeholder="Dejar vac√≠o para no cambiar">
                </div>
                <div class="form-group">
                    <label for="edit-password-confirm">Confirmar Contrase√±a</label>
                    <input type="password" id="edit-password-confirm" [(ngModel)]="confirmEditPassword"
                        name="edit_password_confirm" class="form-control" placeholder="Repita la nueva contrase√±a">
                </div>

                <div class="form-group" *ngIf="entities?.length">
                    <label for="edit-entity">Entidad</label>
                    <select id="edit-entity" [(ngModel)]="editUserForm.entity_id" name="edit_entity"
                        class="form-control">
                        <option [ngValue]="undefined">(Sin entidad)</option>
                        <option *ngFor="let e of entities" [ngValue]="e.id">{{ e.name }}</option>
                    </select>
                    <small class="form-hint">Solo Superadmin puede cambiar de entidad</small>
                </div>
            </div>

            <!-- ‚úÖ M√≥dulos si es admin Y si el usuario actual es SuperAdmin -->
            <ng-container *ngIf="editUserForm.role === 'admin' && currentUserRole === 'superadmin'">
                <!-- Mostrar m√≥dulos si la entidad est√° cargada -->
                <div *ngIf="editingUserEntity" class="form-group">
                    <label>M√≥dulos Permitidos</label>
                    <small class="text-muted d-block mb-2">Selecciona los m√≥dulos activos en la entidad: <strong>{{ editingUserEntity.name }}</strong></small>
                    <div class="checkbox-grid">
                        <label *ngIf="editingUserEntity.enable_pqrs"><input type="checkbox" [(ngModel)]="editUserModules.enable_pqrs" name="edit_enable_pqrs"> PQRS</label>
                        <label *ngIf="editingUserEntity.enable_users_admin"><input type="checkbox" [(ngModel)]="editUserModules.enable_users_admin" name="edit_enable_users_admin"> Administraci√≥n de Usuarios</label>
                        <label *ngIf="editingUserEntity.enable_planes_institucionales"><input type="checkbox" [(ngModel)]="editUserModules.enable_planes_institucionales" name="edit_enable_planes_institucionales"> Planes Institucionales</label>
                        <label *ngIf="editingUserEntity.enable_pdm"><input type="checkbox" [(ngModel)]="editUserModules.enable_pdm" name="edit_enable_pdm"> Plan de Desarrollo Municipal</label>
                        <label *ngIf="editingUserEntity.enable_contratacion"><input type="checkbox" [(ngModel)]="editUserModules.enable_contratacion" name="edit_enable_contratacion"> Contrataci√≥n</label>
                        <label *ngIf="editingUserEntity.enable_reports_pdf"><input type="checkbox" [(ngModel)]="editUserModules.enable_reports_pdf" name="edit_enable_reports_pdf"> Reportes PDF</label>
                        <label *ngIf="editingUserEntity.enable_ai_reports"><input type="checkbox" [(ngModel)]="editUserModules.enable_ai_reports" name="edit_enable_ai_reports"> An√°lisis con IA</label>
                    </div>
                </div>

                <!-- Mostrar mensaje si est√° cargando la entidad -->
                <div *ngIf="editingUserEntity === null && editingUser?.entity_id" class="form-group">
                    <label>M√≥dulos Permitidos</label>
                    <p class="text-muted small">‚è≥ Cargando informaci√≥n de la entidad...</p>
                </div>

                <!-- Mostrar mensaje si el usuario NO tiene entidad asignada -->
                <div *ngIf="editingUserEntity === null && !editingUser?.entity_id" class="form-group">
                    <label>M√≥dulos Permitidos</label>
                    <p class="text-muted small">‚ö†Ô∏è Este usuario no tiene entidad asignada. No se pueden asignar m√≥dulos.</p>
                </div>
            </ng-container>

            <!-- ‚úÖ Mensaje si no es SuperAdmin y est√° editando admin -->
            <div *ngIf="editUserForm.role === 'admin' && currentUserRole !== 'superadmin'" class="alert alert-info">
                <strong>‚ö†Ô∏è Informaci√≥n:</strong> Solo el SuperAdmin puede cambiar los m√≥dulos de los administradores. Para cambiar m√≥dulos, contacte al SuperAdmin.
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="cancelEditUser()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="loading">
                    {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
            </div>
        </form>
    </div>

    <!-- Vista: Crear Admin -->
    <div *ngIf="currentView === 'create-admin'" class="create-admin-view">
        <div class="view-header">
            <h2>Nuevo Administrador para {{ selectedEntity?.name }}</h2>
            <button class="btn btn-secondary" (click)="viewEntityUsers(selectedEntity!)">
                ‚Üê Volver
            </button>
        </div>

        <form class="form-container" (ngSubmit)="createAdmin()">
            <div class="form-group">
                <label for="role">Rol *</label>
                <select id="role" [(ngModel)]="newAdmin.role" name="role" required class="form-control">
                    <option value="admin">Administrador</option>
                    <option value="secretario">Secretario</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="username">Nombre de Usuario *</label>
                    <input type="text" id="username" [(ngModel)]="newAdmin.username" name="username" required
                        class="form-control">
                </div>

                <div class="form-group">
                    <label for="full_name">Nombre Completo *</label>
                    <input type="text" id="full_name" [(ngModel)]="newAdmin.full_name" name="full_name" required
                        class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" [(ngModel)]="newAdmin.email" name="email" required class="form-control">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="password">Contrase√±a *</label>
                    <input type="password" id="password" [(ngModel)]="newAdmin.password" name="password" required
                        class="form-control">
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirmar Contrase√±a *</label>
                    <input type="password" id="confirmPassword" [(ngModel)]="confirmPassword" name="confirmPassword"
                        required class="form-control">
                </div>
            </div>

            <!-- ‚úÖ M√≥dulos Permitidos - Solo SuperAdmin -->
            <div *ngIf="selectedEntity && currentUserRole === 'superadmin'" class="form-group">
                <label>M√≥dulos Permitidos</label>
                <small class="text-muted d-block mb-2">Se mostrar√°n solo los m√≥dulos activos en la entidad: {{ selectedEntity.name }}</small>
                <div class="checkbox-grid">
                    <label *ngIf="selectedEntity.enable_pqrs"><input type="checkbox" [(ngModel)]="newAdminModules.enable_pqrs" name="admin_enable_pqrs"> PQRS</label>
                    <label *ngIf="selectedEntity.enable_users_admin"><input type="checkbox" [(ngModel)]="newAdminModules.enable_users_admin" name="admin_enable_users_admin"> Administraci√≥n de Usuarios</label>
                    <label *ngIf="selectedEntity.enable_planes_institucionales"><input type="checkbox" [(ngModel)]="newAdminModules.enable_planes_institucionales" name="admin_enable_planes_institucionales"> Planes Institucionales</label>
                    <label *ngIf="selectedEntity.enable_pdm"><input type="checkbox" [(ngModel)]="newAdminModules.enable_pdm" name="admin_enable_pdm"> Plan de Desarrollo Municipal</label>
                    <label *ngIf="selectedEntity.enable_contratacion"><input type="checkbox" [(ngModel)]="newAdminModules.enable_contratacion" name="admin_enable_contratacion"> Contrataci√≥n</label>
                    <label *ngIf="selectedEntity.enable_reports_pdf"><input type="checkbox" [(ngModel)]="newAdminModules.enable_reports_pdf" name="admin_enable_reports_pdf"> Reportes PDF</label>
                    <label *ngIf="selectedEntity.enable_ai_reports"><input type="checkbox" [(ngModel)]="newAdminModules.enable_ai_reports" name="admin_enable_ai_reports"> An√°lisis con IA</label>
                </div>
            </div>

            <!-- ‚úÖ Mensaje si no es SuperAdmin -->
            <div *ngIf="selectedEntity && currentUserRole !== 'superadmin'" class="alert alert-info">
                <strong>‚ÑπÔ∏è Informaci√≥n:</strong> Los m√≥dulos del administrador ser√°n asignados por el SuperAdmin. Los administradores no pueden tener m√≥dulos espec√≠ficos.
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="viewEntityUsers(selectedEntity!)">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="loading">
                    {{ loading ? 'Creando...' : 'Crear Usuario' }}
                </button>
            </div>
        </form>
    </div>
</div>